import{a as C,d as x,o as d,c as v,b as f,t as S,u as s,_ as I,F as E,r as O,e as y,V as A,f as U,p as ie,m as re,g as de,h as ue,i as ce,j as me,k as pe,l as H,n as _e,q as fe,s as X,v as c,w as q,x as _,y as h,z as F,A as ve,B as Z,C as be,D as ee,E as ge,G as he,H as te,I as ye,J as Ve,K as ae,M as se,L as z,N as ne,O as oe,P as we,Q as Ce,R as xe,S as Ie,T as ke}from"./index.18c97867.js";import{V as Se}from"./VAutocomplete.bc42fef9.js";import{m as $e,V as Y}from"./VSelect.91ed2901.js";const{Axios:Vt,AxiosError:Be,CanceledError:wt,isCancel:Ct,CancelToken:xt,VERSION:It,all:kt,Cancel:St,isAxiosError:$t,spread:Bt,toFormData:Ut,AxiosHeaders:Ft,HttpStatusCode:Et,formToJSON:At,getAdapter:Dt,mergeConfig:Lt}=C,Ue={class:"install-view-license"},Fe={class:"install-view-license-content"},Ee=x({__name:"InstallViewLicense",setup(r){const n=w();return(e,l)=>(d(),v("div",Ue,[f("div",Fe,S(s(n).license),1)]))}});const Ae=I(Ee,[["__scopeId","data-v-bf8623c1"]]),De={class:"install-view-environment"},Le={style:{display:"flex",gap:"8px","flex-wrap":"wrap"}},Pe={class:"install-view-environment-item-title"},Ne={key:0,class:"install-view-environment-item-message"},Me=x({__name:"InstallViewEnvironment",setup(r){const n=w();return(e,l)=>(d(),v("div",De,[(d(!0),v(E,null,O(s(n).environment,(o,t)=>(d(),v("div",{key:t,class:"install-view-environment-item"},[o.status===1?(d(),y(A,{key:0,icon:"mdi-check-circle",color:"#097c31",size:"20"})):(d(),y(A,{key:1,icon:"mdi-close-circle",color:"#ac0221",size:"20"})),f("div",Le,[f("span",Pe,S(o.label),1),o.message?(d(),v("span",Ne,S(o.message),1)):U("",!0)])]))),128))]))}});const Te=I(Me,[["__scopeId","data-v-55f5d8dd"]]);const qe=ie({...re(),...de($e(),["inline"])},"VCheckbox"),ze=ue()({name:"VCheckbox",inheritAttrs:!1,props:qe(),emits:{"update:modelValue":r=>!0,"update:focused":r=>!0},setup(r,n){let{attrs:e,slots:l}=n;const o=ce(r,"modelValue"),{isFocused:t,focus:a,blur:i}=me(r),u=pe(),V=H(()=>r.id||`checkbox-${u}`);return _e(()=>{const[g,k]=fe(e),[D,j]=X.filterProps(r),[L,G]=Y.filterProps(r);return c(X,q({class:["v-checkbox",r.class]},g,D,{modelValue:o.value,"onUpdate:modelValue":$=>o.value=$,id:V.value,focused:t.value,style:r.style}),{...l,default:$=>{let{id:P,messagesId:N,isDisabled:M,isReadonly:T}=$;return c(Y,q(L,{id:P.value,"aria-describedby":N.value,disabled:M.value,readonly:T.value},k,{modelValue:o.value,"onUpdate:modelValue":p=>o.value=p,onFocus:a,onBlur:i}),l)}})}),{}}}),Oe={class:"install-view-database-config"},He=x({__name:"InstallViewDatabaseConfig",setup(r,{expose:n}){const e=w(),l=_({dbname:"",host:"",port:"",username:""});return n({validate:()=>{var t,a,i;l.value={dbname:"",host:"",port:"",username:""};let o=!0;return(t=e.databaseConfig.dbname)!=null&&t.trim()||(l.value.dbname="Field is required",o=!1),(a=e.databaseConfig.host)!=null&&a.trim()||(l.value.host="Field is required",o=!1),e.databaseConfig.port||(l.value.port="Field is required",o=!1),(i=e.databaseConfig.username)!=null&&i.trim()||(l.value.username="Field is required",o=!1),o}}),(o,t)=>(d(),v("div",Oe,[c(h,{modelValue:s(e).databaseConfig.dbname,"onUpdate:modelValue":t[0]||(t[0]=a=>s(e).databaseConfig.dbname=a),label:"Database name",variant:"outlined",density:"comfortable","error-messages":l.value.dbname,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).databaseConfig.host,"onUpdate:modelValue":t[1]||(t[1]=a=>s(e).databaseConfig.host=a),label:"Database host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).databaseConfig.port,"onUpdate:modelValue":t[2]||(t[2]=a=>s(e).databaseConfig.port=a),label:"Database port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).databaseConfig.username,"onUpdate:modelValue":t[3]||(t[3]=a=>s(e).databaseConfig.username=a),label:"Username",variant:"outlined",density:"comfortable","error-messages":l.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).databaseConfig.password,"onUpdate:modelValue":t[4]||(t[4]=a=>s(e).databaseConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":"auto"},null,8,["modelValue"]),c(Se,{modelValue:s(e).databaseConfig.collation,"onUpdate:modelValue":t[5]||(t[5]=a=>s(e).databaseConfig.collation=a),items:s(R).db_collations,label:"Database collation",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","items"])]))}});const Re=I(He,[["__scopeId","data-v-769aaded"]]),je={class:"install-view-elastic-config"},Ge=x({__name:"InstallViewElasticConfig",setup(r,{expose:n}){const e=w(),l=_({host:"",port:""});return n({validate:()=>{var t;l.value={host:"",port:""};let o=!0;return(t=e.elasticConfig.host)!=null&&t.trim()||(l.value.host="Field is required",o=!1),e.elasticConfig.port||(l.value.port="Field is required",o=!1),o}}),(o,t)=>(d(),v("div",je,[c(h,{modelValue:s(e).elasticConfig.host,"onUpdate:modelValue":t[0]||(t[0]=a=>s(e).elasticConfig.host=a),label:"Elastic host",variant:"outlined",density:"comfortable","error-messages":l.value.host,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).elasticConfig.port,"onUpdate:modelValue":t[1]||(t[1]=a=>s(e).elasticConfig.port=a),label:"Elastic port",variant:"outlined",density:"comfortable","error-messages":l.value.port,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).elasticConfig.username,"onUpdate:modelValue":t[2]||(t[2]=a=>s(e).elasticConfig.username=a),label:"Username (optional)",variant:"outlined",density:"comfortable","hide-details":""},null,8,["modelValue"]),c(h,{modelValue:s(e).elasticConfig.password,"onUpdate:modelValue":t[3]||(t[3]=a=>s(e).elasticConfig.password=a),type:"password",label:"Password (optional)",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","hide-details":""},null,8,["modelValue"])]))}});const Je=I(Ge,[["__scopeId","data-v-e14265ac"]]),Ke={class:"install-view-site-config"},Qe={class:"install-view-dummy-data"},We={class:"install-view-dummy-data-help"},Xe=x({__name:"InstallViewSiteConfig",setup(r,{expose:n}){const e=w(),l=_(!1),o=_({url:"",username:"",password:""});return n({validate:()=>{var a,i,u;o.value={url:"",username:"",password:""};let t=!0;return(a=e.siteConfig.url)!=null&&a.trim()||(o.value.url="Field is required",t=!1),(i=e.siteConfig.username)!=null&&i.trim()||(o.value.username="Field is required",t=!1),(u=e.siteConfig.password)!=null&&u.trim()||(o.value.password="Field is required",t=!1),t}}),(t,a)=>(d(),v("div",Ke,[c(h,{modelValue:s(e).siteConfig.url,"onUpdate:modelValue":a[0]||(a[0]=i=>s(e).siteConfig.url=i),label:"Site URL",variant:"outlined",density:"comfortable","error-messages":o.value.url,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).siteConfig.username,"onUpdate:modelValue":a[1]||(a[1]=i=>s(e).siteConfig.username=i),label:"Admin username",variant:"outlined",density:"comfortable","error-messages":o.value.username,"hide-details":"auto"},null,8,["modelValue","error-messages"]),c(h,{modelValue:s(e).siteConfig.password,"onUpdate:modelValue":a[2]||(a[2]=i=>s(e).siteConfig.password=i),type:l.value?"text":"password",label:"Admin password",variant:"outlined",density:"comfortable",autocomplete:"one-time-code","append-inner-icon":l.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":a[3]||(a[3]=i=>l.value=!l.value),"error-messages":o.value.password,"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","error-messages"]),f("div",Qe,[c(ze,{modelValue:s(e).siteConfig.demodata,"onUpdate:modelValue":a[4]||(a[4]=i=>s(e).siteConfig.demodata=i),color:"secondary",label:"Import dummy data","hide-details":""},null,8,["modelValue"]),c(ve,{location:"top start",text:"A set of dummy records will be installed on your system for demonstration purposes."},{activator:F(({props:i})=>[f("div",We,[c(A,q(i,{icon:"mdi-help",size:"14",color:"white"}),null,16)])]),_:1})])]))}});const Ye=I(Xe,[["__scopeId","data-v-db6eb85a"]]),Ze={class:"install-view-installation"},et={class:"installation-step-label"},tt=x({__name:"InstallViewInstallation",setup(r){const n=w(),e=_({}),l=_(null),o=_(null);Z(async()=>{n.install(),await t(),o.value=setInterval(async()=>{await t()},1e3)}),be(()=>{o.value&&clearInterval(o.value)});async function t(){var i;try{const u=await C.get("api/install/status");Object.keys(u.data||{}).length!==Object.keys(e.value).length&&(e.value=u.data||{})}catch(u){u instanceof Be&&((i=u.response)==null?void 0:i.status)===404&&(n.isInstallationCompleted=!0)}}const a=H(()=>{var i;return Object.keys((i=e.value)!=null?i:{}).length?Object.keys(e.value).map(u=>parseInt(u)).sort((u,V)=>u<V?1:u>V?-1:0)[0]:0});return ee(()=>e.value,async()=>{var i;await ge(),(i=l.value)==null||i.scrollTo({behavior:"smooth",left:0,top:l.value.scrollHeight})}),(i,u)=>(d(),v("div",Ze,[c(he,{color:"primary",stream:"","rounded-bar":"",rounded:"",height:"6",style:{"min-height":"6px"},"model-value":a.value,max:21},null,8,["model-value"]),f("div",{class:"install-view-installation-steps",ref_key:"stepsContainer",ref:l},[(d(!0),v(E,null,O(e.value,(V,g)=>(d(),v("div",{key:g,class:"install-view-installation-step"},[parseInt(g)===a.value?(d(),y(te,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",style:{overflow:"hidden"}})):(d(),y(A,{key:1,icon:"mdi-check-circle",color:"#097c31",size:"20"})),f("span",et,S(V.replaceAll("_"," ")),1)]))),128))],512)]))}});const at=I(tt,[["__scopeId","data-v-4857cc74"]]),R={steps:[{title:"License",component:Ae,nextBtn:{label:"Accept"}},{title:"System Environment Check",component:Te},{title:"Database configuration",component:Re,nextBtn:{action:async()=>{const r=w();await r.validateDb()&&r.nextStep()}}},{title:"ElasticSearch configuration",component:Je,nextBtn:{action:async()=>{const r=w();await r.validateElastic()&&r.nextStep()}}},{title:"Site configuration",component:Ye},{title:"Installation",component:at,prevBtn:!1,nextBtn:!1}],db_collations:["utf8mb4_general_ci","utf8mb4_bin","utf8mb4_unicode_ci","utf8mb4_icelandic_ci","utf8mb4_latvian_ci","utf8mb4_romanian_ci","utf8mb4_slovenian_ci","utf8mb4_polish_ci","utf8mb4_estonian_ci","utf8mb4_spanish_ci","utf8mb4_swedish_ci","utf8mb4_turkish_ci","utf8mb4_czech_ci","utf8mb4_danish_ci","utf8mb4_lithuanian_ci","utf8mb4_slovak_ci","utf8mb4_spanish2_ci","utf8mb4_roman_ci","utf8mb4_persian_ci","utf8mb4_esperanto_ci","utf8mb4_hungarian_ci","utf8mb4_sinhala_ci","utf8mb4_german2_ci","utf8mb4_croatian_ci","utf8mb4_unicode_520_ci","utf8mb4_vietnamese_ci"]},w=ye("install-view",()=>{const r=Ve(),n=_(!1),e=_(!1),l=_(!1),o=_(""),t=_(null),a=_(null),i=_({dbname:"minthcm",host:"localhost",port:3306,username:"root",password:"",collation:"utf8mb4_general_ci"}),u=_({host:"localhost",port:9200,username:"",password:""}),V=_({url:"",username:"admin",password:"",demodata:!1}),g=_(""),k=_(0),D=H(()=>R.steps[k.value]);async function j(){var p,b,m,J,K,Q,W;e.value=!0;try{const B=await C.get("api/install/init");o.value=(b=(p=B.data)==null?void 0:p.version)!=null?b:"",t.value=(J=(m=B.data)==null?void 0:m.license)!=null?J:"",a.value=(Q=(K=B.data)==null?void 0:K.environment)!=null?Q:"",e.value=!1}catch(B){((W=B.response)==null?void 0:W.status)===404&&r.push({name:"dashboard"})}}async function L(){var b,m;const p=await C.get("api/install/license");t.value=(m=(b=p.data)==null?void 0:b.license)!=null?m:""}async function G(){const p=await C.get("api/install/environment");a.value=p.data}async function $(){var p,b;n.value=!0;try{const m=await C.post("api/install/validate_db",i.value);return n.value=!1,((p=m.data)==null?void 0:p.status)===0?(g.value=m.data.message,console.error((b=m.data.error)!=null?b:m.data.message),!1):!0}catch(m){return console.error(m),g.value="Server error",n.value=!1,!1}}async function P(){var p,b;n.value=!0;try{const m=await C.post("api/install/validate_elastic",u.value);return n.value=!1,((p=m.data)==null?void 0:p.status)===0?(g.value=m.data.message,console.error((b=m.data.error)!=null?b:m.data.message),!1):!0}catch(m){return console.error(m),g.value="Server error",n.value=!1,!1}}async function N(){var b,m;const p=await C.post("api/install/submit",{db:i.value,elastic:u.value,site:V.value});return((b=p.data)==null?void 0:b.status)===0?(g.value=p.data.message,console.error((m=p.data.error)!=null?m:p.data.message),!1):(l.value=!0,!0)}function M(){k.value--}function T(){k.value++}return ee(()=>k.value,()=>g.value=""),{currentStepNumber:k,currentStep:D,isInitialLoading:e,isLoading:n,isInstallationCompleted:l,version:o,license:t,environment:a,databaseConfig:i,elasticConfig:u,siteConfig:V,errorMsg:g,prevStep:M,nextStep:T,fetchLicense:L,fetchEnvironment:G,fetchInitialData:j,validateDb:$,validateElastic:P,install:N}}),st=r=>(ne("data-v-bef3d2ea"),r=r(),oe(),r),nt={class:"install-view-completed"},ot=st(()=>f("h1",null,"Finished",-1)),lt=x({__name:"InstallViewCompleted",setup(r){function n(){location.reload()}return(e,l)=>(d(),v("div",nt,[ot,c(se,{type:"success"},{default:F(()=>[ae(" Your MintHCM installation is ready. Go ahead and log-in as an administrator. ")]),_:1}),c(z,{variant:"primary",text:"Go to login",style:{width:"100%"},onClick:n})]))}});const it=I(lt,[["__scopeId","data-v-bef3d2ea"]]),le=r=>(ne("data-v-31d0bb7d"),r=r(),oe(),r),rt={key:1,class:"install-view"},dt={class:"install-view-title"},ut=le(()=>f("h1",null,"MintHCM Setup Wizard",-1)),ct={class:"install-view-container"},mt={key:0,class:"install-view-loader"},pt={class:"install-view-container-title"},_t={class:"install-view-buttons"},ft={class:"install-view-footer"},vt=le(()=>f("div",{class:"install-view-footer"},[f("a",{href:"https://minthcm.org",target:"_blank"}," www.minthcm.org ")],-1)),bt=x({__name:"InstallView",setup(r){const n=w(),e=_(null);Z(()=>{n.fetchInitialData()});function l(){var o,t;typeof((o=e.value)==null?void 0:o.validate)=="function"&&!e.value.validate()||(n.currentStep.nextBtn&&typeof((t=n.currentStep.nextBtn)==null?void 0:t.action)=="function"?n.currentStep.nextBtn.action():n.nextStep())}return(o,t)=>{var a,i;return s(n).isInitialLoading?(d(),y(xe,{key:0})):(d(),v("div",rt,[f("div",dt,[ut,f("span",null,"Version "+S(s(n).version),1)]),f("div",ct,[s(n).isInstallationCompleted?(d(),y(it,{key:0})):(d(),v(E,{key:1},[c(we,null,{default:F(()=>[s(n).isLoading?(d(),v("div",mt,[c(te,{indeterminate:"",color:"primary",size:"64"})])):U("",!0)]),_:1}),f("div",pt,S(s(n).currentStep.title),1),s(n).errorMsg?(d(),y(se,{key:0,type:"error"},{default:F(()=>[ae(S(s(n).errorMsg),1)]),_:1})):U("",!0),c(Ce,{"hide-on-leave":""},{default:F(()=>{var u;return[(d(),y(Ie((u=s(n).currentStep)==null?void 0:u.component),{ref_key:"stepComponent",ref:e},null,512))]}),_:1}),f("div",_t,[s(n).currentStep.prevBtn!==!1&&s(n).currentStepNumber!==0?(d(),y(z,{key:0,variant:"text",text:"Back",onClick:s(n).prevStep},null,8,["onClick"])):U("",!0),s(n).currentStep.nextBtn!==!1?(d(),y(z,{key:1,variant:"primary",text:(i=(a=s(n).currentStep.nextBtn)==null?void 0:a.label)!=null?i:"Next",onClick:l},null,8,["text"])):U("",!0)]),f("div",ft,[(d(!0),v(E,null,O(s(R).steps.length,u=>(d(),v("div",{key:u,class:ke({"install-view-footer-dot":!0,"install-view-footer-dot-active":s(n).currentStepNumber===u-1})},null,2))),128))])],64))]),vt]))}}});const Pt=I(bt,[["__scopeId","data-v-31d0bb7d"]]);export{Pt as default};
